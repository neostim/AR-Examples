
<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script>
      AFRAME.registerComponent('markerhandler', {
        init: function() {
          this.el.sceneEl.addEventListener('markerFound', () => {
            this.el.object3D.visible = true;
          });
          this.el.sceneEl.addEventListener('markerLost', () => {
            this.el.object3D.visible = false;
          });
        },
        tick: function() {
          if (this.el.object3D.visible) {
            const camera = document.querySelector('#camera');
            const model = this.el.object3D;
            const marker = this.el.sceneEl.querySelector('a-marker');

            // Get marker position and rotation in camera space
            const matrix = new THREE.Matrix4();
            matrix.getInverse(camera.object3D.matrixWorld);
            matrix.multiply(marker.object3D.matrixWorld);
            const position = new THREE.Vector3();
            const quaternion = new THREE.Quaternion();
            const scale = new THREE.Vector3();
            matrix.decompose(position, quaternion, scale);

            // Set model position and rotation based on marker
            model.position.copy(position);
            model.quaternion.copy(quaternion);
          }
        }
      });
    </script>
  </head>
  <body style="margin: 0;">
    <a-scene embedded arjs>
          <a-marker preset="hiro" id="hiro-marker" emitevents="true">
        <a-entity id="model" gltf-model="models/assembly.gltf" scale="1 1 1" position="0 0 0" rotation="0 0 0" markerhandler></a-entity>
      </a-marker>
      <a-entity camera id="camera"></a-entity>
    </a-scene>
  </body>
</html>

