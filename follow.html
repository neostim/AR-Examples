<!DOCTYPE html>
<html>
   <head>
      <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5.1675469404/pose.min.js"></script>
      <script>
         AFRAME.registerComponent('markerhandler', {
             init: function() {
                 this.el.sceneEl.addEventListener('markerFound', () => {
                     this.el.object3D.visible = true;
                 });
                 this.el.sceneEl.addEventListener('markerLost', () => {
                     this.el.object3D.visible = false;
                 });
             },
             tick: function() {
                 const marker = this.el.object3D;
                 const camera = document.querySelector('[camera]').object3D;
                 const markerInverseMatrix = new THREE.Matrix4();
                 const markerWorldMatrix = new THREE.Matrix4();
                 marker.matrixWorldInverse.getInverse(markerWorldMatrix);
                 markerInverseMatrix.multiplyMatrices(camera.matrixWorld, markerWorldMatrix);
                 const {position, quaternion, scale} = new THREE.Matrix4().setFromMatrixPosition(markerInverseMatrix);
                 this.el.object3D.position.copy(position);
                 this.el.object3D.quaternion.copy(quaternion);
                 this.el.object3D.scale.copy(scale);
             }
         });
      </script>
   </head>
   <body>
      <a-scene>
         <a-assets>
            <a-asset-item id="model" src="models/assembly.gltf" response-type="arraybuffer"></a-asset-item>
         </a-assets>
         <a-marker type="hiro">
            <a-entity gltf-model="#model" markerhandler></a-entity>
         </a-marker>
         <a-entity camera></a-entity>
      </a-scene>
   </body>
</html>
